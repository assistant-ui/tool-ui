import { DocsHeader } from "../_components/docs-header";
import {
  PreferencesPanel,
  PreferencesPanelReceipt,
} from "@/components/tool-ui/preferences-panel";

<DocsHeader
  title="Preferences Panel"
  description="Compact settings panel with staged changes."
  mdxPath="app/docs/preferences-panel/content.mdx"
/>

<Tabs items={["Preview", "Code"]}>
  <Tab>
    <div className="not-prose mx-auto max-w-md">
      <PreferencesPanel
        id="preferences-panel-example"
        sections={[
          {
            items: [
              {
                id: "notifications",
                label: "Notifications",
                description: "Receive push notifications",
                type: "switch",
                defaultChecked: true,
              },
              {
                id: "theme",
                label: "Theme",
                description: "Choose your appearance",
                type: "toggle",
                options: [
                  { value: "light", label: "Light" },
                  { value: "dark", label: "Dark" },
                  { value: "auto", label: "Auto" },
                ],
                defaultValue: "auto",
              },
              {
                id: "analytics",
                label: "Analytics",
                description: "Help improve the product",
                type: "switch",
                defaultChecked: false,
              },
            ],
          },
        ]}
      />
    </div>
  </Tab>
  <Tab>
    ```tsx
    import { PreferencesPanel } from "@/components/tool-ui/preferences-panel";

    export function Example() {
      return (
        <PreferencesPanel
          id="preferences-panel-example"
          sections={[
            {
              items: [
                {
                  id: "notifications",
                  label: "Notifications",
                  description: "Receive push notifications",
                  type: "switch",
                  defaultChecked: true,
                },
                {
                  id: "theme",
                  label: "Theme",
                  description: "Choose your appearance",
                  type: "toggle",
                  options: [
                    { value: "light", label: "Light" },
                    { value: "dark", label: "Dark" },
                    { value: "auto", label: "Auto" },
                  ],
                  defaultValue: "auto",
                },
                {
                  id: "analytics",
                  label: "Analytics",
                  description: "Help improve the product",
                  type: "switch",
                  defaultChecked: false,
                },
              ],
            },
          ]}
        />
      );
    }
    ```
  </Tab>
</Tabs>

## Key Features

<FeatureGrid>
  <Feature icon="Settings2" title="Three control types">
    Switch for binary choices, toggle for 2-4 options, select for 5+ options
  </Feature>
  <Feature icon="SquareCheck" title="Staged changes">
    Explicit Save/Cancel actions prevent accidental changes
  </Feature>
  <Feature icon="CheckCircle2" title="Receipt state">
    Terminal state showing confirmed selections with success indicators
  </Feature>
  <Feature icon="Layers" title="Organized sections">
    Group related settings with optional section headings
  </Feature>
</FeatureGrid>

## Receipt State

Use `<PreferencesPanelReceipt>` to render the confirmed selections after the user saves. This is ideal for conversation history.

<Tabs items={["Saved", "With Errors"]}>
  <Tab>
    <div className="not-prose mx-auto max-w-md">
      <PreferencesPanelReceipt
        id="preferences-panel-receipt"
        title="Privacy Settings"
        sections={[
          {
            heading: "Visibility",
            items: [
              {
                id: "profile-visibility",
                label: "Profile Visibility",
                description: "Who can see your profile",
                type: "toggle",
                options: [
                  { value: "public", label: "Public" },
                  { value: "connections", label: "Friends" },
                  { value: "private", label: "Private" },
                ],
                defaultValue: "connections",
              },
              {
                id: "activity-status",
                label: "Activity Status",
                description: "Show when you're active",
                type: "switch",
                defaultChecked: true,
              },
            ],
          },
        ]}
        choice={{
          "profile-visibility": "private",
          "activity-status": false,
        }}
      />
    </div>
  </Tab>
  <Tab>
    <div className="not-prose mx-auto max-w-md">
      <PreferencesPanelReceipt
        id="preferences-panel-receipt-errors"
        title="Privacy Settings"
        sections={[
          {
            heading: "Visibility",
            items: [
              {
                id: "profile-visibility",
                label: "Profile Visibility",
                description: "Who can see your profile",
                type: "toggle",
                options: [
                  { value: "public", label: "Public" },
                  { value: "connections", label: "Friends" },
                  { value: "private", label: "Private" },
                ],
                defaultValue: "connections",
              },
              {
                id: "activity-status",
                label: "Activity Status",
                description: "Show when you're active",
                type: "switch",
                defaultChecked: true,
              },
            ],
          },
        ]}
        choice={{
          "profile-visibility": "private",
          "activity-status": false,
        }}
        error={{
          "profile-visibility": "Private profiles require a verified account",
        }}
      />
    </div>
  </Tab>
</Tabs>

## Source and Install

Copy [`components/tool-ui/preferences-panel`](https://github.com/assistant-ui/tool-ui/tree/main/components/tool-ui/preferences-panel) and the [`shared`](https://github.com/assistant-ui/tool-ui/tree/main/components/tool-ui/shared) directory into your project. The `shared` folder contains utilities used by all Tool UI components. The `tool-ui` directory should sit alongside your shadcn `ui` directory.

### Prerequisites

This component requires the following [shadcn/ui](https://ui.shadcn.com) components:

```bash
pnpm dlx shadcn@latest add button label select separator switch toggle-group
```

### Directory Structure

<Files>
  <Folder name="components" defaultOpen>
    <Folder name="ui">
      <File name="button.tsx" />
      <File name="label.tsx" />
      <File name="select.tsx" />
      <File name="separator.tsx" />
      <File name="switch.tsx" />
      <File name="toggle-group.tsx" />
    </Folder>
    <Folder name="tool-ui" defaultOpen>
      <Folder name="shared" defaultOpen>
        <File name="action-buttons.tsx" />
        <File name="schema.ts" />
        <File name="index.ts" />
      </Folder>
      <Folder name="preferences-panel" defaultOpen>
        <File name="preferences-panel.tsx" />
        <File name="schema.ts" />
        <File name="index.tsx" />
        <File name="_adapter.tsx" />
        <File name="error-boundary.tsx" />
      </Folder>
    </Folder>
  </Folder>
</Files>

### Download

- [**Shared Dependencies (GitHub)**](https://github.com/assistant-ui/tool-ui/tree/main/components/tool-ui/shared) ([ZIP](https://download-directory.github.io/?url=https://github.com/assistant-ui/tool-ui/tree/main/components/tool-ui/shared))
- [**Preferences Panel (GitHub)**](https://github.com/assistant-ui/tool-ui/tree/main/components/tool-ui/preferences-panel) ([ZIP](https://download-directory.github.io/?url=https://github.com/assistant-ui/tool-ui/tree/main/components/tool-ui/preferences-panel))

## Usage

```tsx
"use client";

import { makeAssistantTool } from "@assistant-ui/react";
import {
  PreferencesPanel,
  PreferencesPanelReceipt,
  PreferencesPanelErrorBoundary,
  parseSerializablePreferencesPanel,
  SerializablePreferencesPanelSchema,
  type SerializablePreferencesPanel,
  type PreferencesValue,
} from "@/components/tool-ui/preferences-panel";

type PreferencesPanelResult =
  | { status: "saved"; values: PreferencesValue }
  | { status: "cancelled" };

export const PreferencesPanelTool = makeAssistantTool<
  SerializablePreferencesPanel,
  PreferencesPanelResult
>({
  toolName: "show_preferences_panel",
  description: "Display user preference settings with staged changes",
  parameters: SerializablePreferencesPanelSchema,
  render: ({ args, addResult, toolCallId, result }) => {
    if (!args.sections) return null;

    const data = parseSerializablePreferencesPanel({
      ...args,
      id: (args as any)?.id ?? `preferences-panel-${toolCallId}`,
    });

    return (
      <PreferencesPanelErrorBoundary>
        {result?.status === "saved" ? (
          <PreferencesPanelReceipt {...data} choice={result.values} />
        ) : (
          <PreferencesPanel
            {...data}
            onSave={async (values) => {
              await addResult({ status: "saved", values });
            }}
            onCancel={() => {
              addResult({ status: "cancelled" });
            }}
          />
        )}
      </PreferencesPanelErrorBoundary>
    );
  },
});
```

## Props

<TypeTable
  type={{
    id: {
      description: "Unique identifier for the preferences panel instance",
      type: "string",
      required: true,
    },
    title: {
      description: "Optional header displayed at top of card",
      type: "string",
    },
    sections: {
      description: "Preference sections with controls (max 2 sections, max 5 total items)",
      type: "PreferenceSection[]",
      required: true,
    },
    value: {
      description: "Controlled values object. When provided, component becomes controlled.",
      type: "PreferencesValue",
    },
    onChange: {
      description: "Called when any preference value changes (before save)",
      type: "(value: PreferencesValue) => void",
    },
    // Receipt rendering uses <PreferencesPanelReceipt> with a required `choice`.
    onSave: {
      description: "Handler called when Save button is clicked. Receives current preference values.",
      type: "(value: PreferencesValue) => void | Promise<void>",
    },
    onCancel: {
      description: "Handler called when Cancel button is clicked. Resets to initial values.",
      type: "() => void",
    },
    responseActions: {
      description: "Custom action buttons. Defaults to Cancel (ghost) and Save Changes (default).",
      type: "Action[] | ActionsConfig",
    },
    onResponseAction: {
      description: "Handler for custom response actions. Receives actionId and current values.",
      type: "(actionId: string, value: PreferencesValue) => void | Promise<void>",
    },
    isLoading: {
      description: "Shows loading spinner on Save button and disables all controls",
      type: "boolean",
    },
    className: {
      description: "Additional CSS classes for the root element",
      type: "string",
    },
  }}
/>

### PreferenceSection

<TypeTable
  type={{
    heading: {
      description: "Optional section heading displayed above items",
      type: "string",
    },
    items: {
      description: "Preference controls in this section. Each section supports 1-3 items.",
      type: "PreferenceItem[]",
      required: true,
    },
  }}
/>

### PreferenceItem

<TypeTable
  type={{
    id: {
      description: "Unique identifier used as key in values object",
      type: "string",
      required: true,
    },
    label: {
      description: "Primary label displayed above the control",
      type: "string",
      required: true,
    },
    description: {
      description: "Optional help text displayed below the label",
      type: "string",
    },
    type: {
      description: "Control type: switch (binary), toggle (2-4 options), select (5+ options)",
      type: '"switch" | "toggle" | "select"',
      required: true,
    },
    defaultChecked: {
      description: "Initial checked state. Required when type is \"switch\".",
      type: "boolean",
    },
    options: {
      description: "Available choices. Required when type is \"toggle\". Supports 2-4 options.",
      type: "{ value: string; label: string }[]",
    },
    defaultValue: {
      description: "Initially selected option value. Required when type is \"toggle\".",
      type: "string",
    },
    selectOptions: {
      description: "Available choices. Required when type is \"select\". Use for 5+ options.",
      type: "{ value: string; label: string }[]",
    },
    defaultSelected: {
      description: "Initially selected option value. Required when type is \"select\".",
      type: "string",
    },
  }}
/>

### PreferencesValue

<TypeTable
  type={{
    "[itemId: string]": {
      description: "Values keyed by item ID. Boolean for switches, string for toggles and selects.",
      type: "string | boolean",
    },
  }}
/>

## Limits

- **Sections**: 2 maximum per panel
- **Items per section**: 3 maximum
- **Total items**: 5 maximum across all sections
- **Toggle options**: 2-4 choices (use select for more)
- **Select options**: 5+ choices (use toggle for fewer)

## Accessibility

- Full keyboard navigation support for all control types
- Labels properly associated with controls using `htmlFor` and `id` attributes
- Save button disabled when no changes exist to prevent unnecessary actions
- `aria-busy` attribute indicates loading state during save operations
- Receipt state uses `role="status"` for screen reader announcements
- All animations respect `prefers-reduced-motion` user preference
- Sufficient color contrast meets WCAG AA standards
- Focus indicators visible on all interactive elements
