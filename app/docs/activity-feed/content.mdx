import { DocsHeader } from "../_components/docs-header";
import { ActivityFeed } from "@/components/tool-ui/activity-feed";

<DocsHeader
  title="Activity Feed"
  description="Size-aware event activity stream."
  mdxPath="app/docs/activity-feed/content.mdx"
/>

> **Canvas Component** — This is a canvas-native component designed for spatial workspaces. It adapts its layout based on container size using CSS container queries.

## Size-Aware Demo

The activity feed adapts to its container width. Resize your browser to see the different modes:

### Large (Over 560px) — Detailed View

<div className="not-prose mx-auto" style={{ maxWidth: "720px" }}>
  <ActivityFeed
    id="demo-large"
    title="Repository Activity"
    groups={[
      {
        label: "Today",
        items: [
          {
            id: "evt-1",
            appearance: { icon: "git-merge", palette: "violet", badge: "Merged" },
            title: "feat: Add activity feed component",
            description: "Implements size-aware activity feed with container queries",
            timestamp: new Date(Date.now() - 3600000).toISOString(),
            actor: { name: "Sarah Chen", avatar: "https://i.pravatar.cc/150?u=sarah" },
          },
          {
            id: "evt-2",
            appearance: { icon: "check", palette: "emerald", badge: "Review" },
            title: "Approved: Update authentication flow",
            description: "LGTM! Nice cleanup of the OAuth logic.",
            timestamp: new Date(Date.now() - 7200000).toISOString(),
            actor: { name: "Marcus Johnson", avatar: "https://i.pravatar.cc/150?u=marcus" },
          },
          {
            id: "evt-3",
            appearance: { icon: "alert-triangle", palette: "rose", badge: "Alert" },
            title: "Performance regression in dashboard load",
            description: "Page load time increased from 1.2s to 3.8s after latest deploy",
            timestamp: new Date(Date.now() - 14400000).toISOString(),
            actor: { name: "Alex Rivera", avatar: "https://i.pravatar.cc/150?u=alex" },
          },
        ],
      },
      {
        label: "Yesterday",
        items: [
          {
            id: "evt-4",
            appearance: { icon: "tag", palette: "amber", badge: "Release" },
            title: "v2.4.0 released",
            description: "New features: Activity feed, improved charts, bug fixes",
            timestamp: new Date(Date.now() - 86400000).toISOString(),
            actor: { name: "Marcus Johnson", avatar: "https://i.pravatar.cc/150?u=marcus" },
          },
          {
            id: "evt-5",
            appearance: { icon: "git-commit", palette: "blue", badge: "Commit" },
            title: "fix: Resolve memory leak in chart component",
            timestamp: new Date(Date.now() - 90000000).toISOString(),
            actor: { name: "Jordan Lee", avatar: "https://i.pravatar.cc/150?u=jordan" },
          },
        ],
      },
    ]}
  />
</div>

### Medium (400-560px) — Standard View

<div className="not-prose mx-auto" style={{ maxWidth: "480px" }}>
  <ActivityFeed
    id="demo-medium"
    title="Repository Activity"
    groups={[
      {
        label: "Today",
        items: [
          {
            id: "evt-1",
            appearance: { icon: "git-merge", palette: "violet", badge: "Merged" },
            title: "feat: Add activity feed component",
            description: "Implements size-aware activity feed with container queries",
            timestamp: new Date(Date.now() - 3600000).toISOString(),
            actor: { name: "Sarah Chen" },
          },
          {
            id: "evt-2",
            appearance: { icon: "message-square", palette: "cyan", badge: "Comment" },
            title: "Approved: Update authentication flow",
            timestamp: new Date(Date.now() - 7200000).toISOString(),
            actor: { name: "Marcus Johnson" },
          },
          {
            id: "evt-3",
            appearance: { icon: "alert-triangle", palette: "orange", badge: "Alert" },
            title: "Performance regression in dashboard load",
            timestamp: new Date(Date.now() - 14400000).toISOString(),
            actor: { name: "Alex Rivera" },
          },
        ],
      },
    ]}
  />
</div>

### Small (Under 400px) — Compact View

<div className="not-prose mx-auto" style={{ maxWidth: "320px" }}>
  <ActivityFeed
    id="demo-small"
    groups={[
      {
        label: "Today",
        items: [
          {
            id: "evt-1",
            appearance: { icon: "rocket", palette: "emerald", badge: "Deploy" },
            title: "feat: Add activity feed component",
            timestamp: new Date(Date.now() - 3600000).toISOString(),
            actor: { name: "Sarah Chen" },
          },
          {
            id: "evt-2",
            appearance: { icon: "zap", palette: "violet", badge: "Fix" },
            title: "fix: Resolve race condition",
            timestamp: new Date(Date.now() - 7200000).toISOString(),
            actor: { name: "Marcus Johnson" },
          },
          {
            id: "evt-3",
            appearance: { icon: "bug", palette: "rose", badge: "Bug" },
            title: "Bug: Dashboard slow",
            timestamp: new Date(Date.now() - 14400000).toISOString(),
            actor: { name: "Alex Rivera" },
          },
        ],
      },
    ]}
  />
</div>

## Canvas-Native Properties

This component demonstrates three canvas-native properties:

| Property | Implementation |
|----------|----------------|
| **Size-aware** | Combines container queries with measured height (compact/standard/detailed) |
| **Live updating** | `refreshInterval` prop triggers `onRefresh` callback (stale indicator after 2x interval by default) |
| **Pre-grouped** | Data source provides `{ label: "Today", items: [...] }` |

## Appearance (Platform-Agnostic)

Instead of platform-specific event enums, the feed accepts **appearance hints**:

- `appearance.icon` — restricted to supported Lucide ids
- `appearance.palette` — fixed palette that covers the spectrum
- `appearance.badge` — short label shown in the detailed view

**Palette options**: `slate`, `blue`, `cyan`, `emerald`, `amber`, `orange`, `rose`, `violet`

**Supported icons**:
`activity`, `alert-triangle`, `bell`, `book-open`, `bug`, `calendar`, `check`,
`circle-dot`, `cloud`, `database`, `dollar-sign`, `flag`, `git-branch`,
`git-commit`, `git-fork`, `git-merge`, `git-pull-request`, `globe`,
`message-square`, `package`, `rocket`, `shield`, `sparkles`, `star`, `tag`,
`user`, `x`, `zap`

## Usage

```tsx
import { ActivityFeed } from "@/components/tool-ui/activity-feed";

<ActivityFeed
  id="repo-activity"
  title="Repository Activity"
  refreshInterval={30000}
  updateBehavior="badge"
  staleAfter={60000}
  groups={[
    {
      label: "Today",
      items: [
        {
          id: "evt-1",
          appearance: {
            icon: "git-merge",
            palette: "violet",
            badge: "Merged",
          },
          title: "feat: Add new feature",
          timestamp: new Date().toISOString(),
          actor: { name: "Developer", avatar: "https://..." },
        },
      ],
    },
  ]}
  onRefresh={() => fetchLatestActivity()}
  onItemClick={(item) => window.open(item.url)}
/>
```

## Props

| Prop | Type | Description |
|------|------|-------------|
| `id` | `string` | Unique identifier (required) |
| `groups` | `ActivityGroup[]` | Pre-grouped activity data (required) |
| `title` | `string` | Optional header title |
| `refreshInterval` | `number \| null` | Auto-refresh interval in ms |
| `updateBehavior` | `"silent" \| "badge" \| "highlight"` | How new items appear |
| `staleAfter` | `number` | Time in ms before showing stale indicator (defaults to 2x `refreshInterval`) |
| `appearance` | `{ icon?, palette?, badge? }` | Optional rendering hints per item |
| `type` | `string` | Optional legacy badge label fallback |
| `maxItems` | `number` | Limit displayed items |
| `emptyMessage` | `string` | Message when no items |
| `isLoading` | `boolean` | Show skeleton state |
| `onRefresh` | `() => void` | Called on refresh interval |
| `onItemClick` | `(item: ActivityItem) => void` | Called when item clicked |

## Roadmap (Post-MVP)

- [ ] Expandable items with detail view
- [ ] Action buttons (navigate, AI actions, triage)
- [ ] Checkbox selection with bulk operations
- [ ] Expand/collapse items with keyboard shortcuts
