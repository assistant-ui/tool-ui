import { DocsHeader } from "../_components/docs-header";
import { DataTable } from "@/components/tool-ui/data-table";
import { FormatInlineExample } from "./formatting-gallery";
import {
  NumberValue,
  CurrencyValue,
  PercentValue,
  DeltaValue,
  DateValue,
  BooleanValue,
  LinkValue,
  BadgeValue,
  StatusBadge,
  ArrayValue,
} from "@/components/tool-ui/data-table";

<DocsHeader
  title="Data Table"
  description="Present structured data in sortable tables."
  mdxPath="app/docs/data-table/content.mdx"
/>

<Tabs items={["Preview", "Code"]}>
  <Tab>
    <div className="not-prose">
      <DataTable.Provider
        rowIdKey="id"
        defaultSort={{ by: "createdAt", direction: "desc" }}
        columns={[
          { key: "issue", label: "Issue", priority: "primary", truncate: true },
          {
            key: "priority",
            label: "Urgency",
            format: {
              kind: "status",
              statusMap: {
                high: { tone: "danger", label: "High" },
                medium: { tone: "warning", label: "Medium" },
                low: { tone: "neutral", label: "Low" },
              },
            },
          },
          {
            key: "createdAt",
            label: "Created",
            format: { kind: "date", dateFormat: "relative" },
          },
          {
            key: "amount",
            label: "Amount",
            align: "right",
            format: { kind: "currency", currency: "USD", decimals: 2 },
          },
        ]}
        data={[
          {
            id: "1",
            issue: "Payment failing on checkout",
            priority: "high",
            createdAt: "2025-11-11T09:24:00Z",
            amount: 129.99,
          },
          {
            id: "2",
            issue: "Billing UI alignment bug",
            priority: "medium",
            createdAt: "2025-11-10T17:03:00Z",
            amount: 42,
          },
          {
            id: "3",
            issue: "Export CSV missing headers",
            priority: "low",
            createdAt: "2025-11-08T08:00:00Z",
            amount: 0,
          },
          {
            id: "4",
            issue: "Webhook retries inconsistent",
            priority: "high",
            createdAt: "2025-11-13T22:15:00Z",
            amount: 527.5,
          },
        ]}
      >
        <DataTable.Table />
        <DataTable.SortAnnouncement />
      </DataTable.Provider>
    </div>
  </Tab>
  <Tab>
    ```tsx
    import { DataTable, type Column } from "@/components/tool-ui/data-table";

    type Row = {
      id: string;
      issue: string;
      priority: "high" | "medium" | "low";
      createdAt: string;
      amount: number;
    };

    const columns: Column<Row>[] = [
      { key: "issue", label: "Issue", priority: "primary", truncate: true },
      {
        key: "priority",
        label: "Urgency",
        format: {
          kind: "status",
          statusMap: {
            high: { tone: "danger", label: "High" },
            medium: { tone: "warning", label: "Medium" },
            low: { tone: "neutral", label: "Low" },
          },
        },
      },
      { key: "createdAt", label: "Created", format: { kind: "date", dateFormat: "relative" } },
      { key: "amount", label: "Amount", align: "right", format: { kind: "currency", currency: "USD", decimals: 2 } },
    ];

    const data: Row[] = [
      {
        id: "1",
        issue: "Payment failing on checkout",
        priority: "high",
        createdAt: "2025-11-11T09:24:00Z",
        amount: 129.99,
      },
      {
        id: "2",
        issue: "Billing UI alignment bug",
        priority: "medium",
        createdAt: "2025-11-10T17:03:00Z",
        amount: 42,
      },
      {
        id: "3",
        issue: "Export CSV missing headers",
        priority: "low",
        createdAt: "2025-11-08T08:00:00Z",
        amount: 0,
      },
      {
        id: "4",
        issue: "Webhook retries inconsistent",
        priority: "high",
        createdAt: "2025-11-13T22:15:00Z",
        amount: 527.5,
      },
    ];

    export default function Example() {
      return (
        <DataTable.Provider
          rowIdKey="id"
          columns={columns}
          data={data}
          defaultSort={{ by: "createdAt", direction: "desc" }}
        >
          <DataTable.Table />
          <DataTable.SortAnnouncement />
        </DataTable.Provider>
      );
    }
    ```

  </Tab>
</Tabs>

## Key Features

<FeatureGrid>
  <Feature icon="Smartphone" title="Responsive layout">
    Automatically switches from table to cards on mobile
  </Feature>
  <Feature icon="ArrowUpDown" title="Sorting">
    Tri-state column sorting: none → ascending → descending
  </Feature>
  <Feature icon="Table2" title="Declarative formatting">
    Currency, dates, links, badges, and more via config
  </Feature>
  <Feature icon="MousePointerClick" title="Response actions">
    Add actionable buttons below the table
  </Feature>
</FeatureGrid>

## Source and Install

Copy [`components/tool-ui/data-table`](https://github.com/assistant-ui/tool-ui/tree/main/components/tool-ui/data-table) and the [`shared`](https://github.com/assistant-ui/tool-ui/tree/main/components/tool-ui/shared) directory into your project. The `shared` folder contains utilities used by all Tool UI components. The `tool-ui` directory should sit alongside your shadcn `ui` directory.

### Prerequisites

This component requires the following [shadcn/ui](https://ui.shadcn.com) components:

```bash
pnpm dlx shadcn@latest add accordion badge button dropdown-menu table tooltip
```

### Directory Structure

<Files>
  <Folder name="components" defaultOpen>
    <Folder name="ui">
      <File name="accordion.tsx" />
      <File name="badge.tsx" />
      <File name="button.tsx" />
      <File name="dropdown-menu.tsx" />
      <File name="table.tsx" />
      <File name="tooltip.tsx" />
      <File name="..." />
    </Folder>
    <Folder name="tool-ui" defaultOpen>
      <Folder name="shared" defaultOpen>
        <File name="action-buttons.tsx" />
        <File name="schema.ts" />
        <File name="index.ts" />
        <File name="..." />
      </Folder>
      <Folder name="data-table" defaultOpen>
        <File name="data-table.tsx" />
        <File name="schema.ts" />
        <File name="types.ts" />
        <File name="index.tsx" />
        <File name="..." />
      </Folder>
    </Folder>
  </Folder>
</Files>

### Download

- [**Shared Dependencies (GitHub)**](https://github.com/assistant-ui/tool-ui/tree/main/components/tool-ui/shared) ([ZIP](https://download-directory.github.io/?url=https://github.com/assistant-ui/tool-ui/tree/main/components/tool-ui/shared))
- [**Data Table (GitHub)**](https://github.com/assistant-ui/tool-ui/tree/main/components/tool-ui/data-table) ([ZIP](https://download-directory.github.io/?url=https://github.com/assistant-ui/tool-ui/tree/main/components/tool-ui/data-table))

## Usage

Define a tool that returns table data, then render with the DataTable component.

```tsx
// Backend tool
import { tool, jsonSchema } from "ai";

const searchProducts = tool({
  description: "Search products and return results in a table",
  inputSchema: jsonSchema<{ query: string }>({
    type: "object",
    properties: { query: { type: "string" } },
    required: ["query"],
    additionalProperties: false,
  }),
  async execute({ query }) {
    const results = await db.products.search(query);
    return {
      id: "data-table-search-products",
      columns: [
        { key: "name", label: "Product", priority: "primary" },
        {
          key: "price",
          label: "Price",
          format: { kind: "currency", currency: "USD" },
        },
        { key: "stock", label: "Stock", align: "right" },
      ],
      data: results.map((p) => ({
        id: p.id,
        name: p.name,
        price: p.price,
        stock: p.stock,
      })),
    };
  },
});

// Frontend with assistant-ui
import { makeAssistantToolUI } from "@assistant-ui/react";
import {
  DataTable,
  DataTableErrorBoundary,
  parseSerializableDataTable,
} from "@/components/tool-ui/data-table";

export const SearchProductsUI = makeAssistantToolUI({
  toolName: "searchProducts",
  render: ({ result }) => {
    // Tool outputs stream in; `result` will be `undefined` until the tool resolves.
    if (result === undefined) {
      return (
        <div className="bg-card/60 text-muted-foreground w-full max-w-xl rounded-2xl border px-5 py-4 text-sm shadow-xs">
          Loading table…
        </div>
      );
    }

    const props = parseSerializableDataTable(result);
    return (
      <DataTableErrorBoundary>
        <DataTable.Provider rowIdKey="id" {...props}>
          <DataTable.Responsive />
          <DataTable.SortAnnouncement />
        </DataTable.Provider>
      </DataTableErrorBoundary>
    );
  },
});
```

## Props

### Core Props

<TypeTable
  type={{
    columns: {
      description: "Column definitions",
      type: "Column[]",
      required: true,
    },
    data: {
      description: "Rows (JSON primitives only)",
      type: "T[]",
      required: true,
    },
    rowIdKey: {
      description: "Unique key per row",
      type: "keyof T",
      required: true,
    },
    locale: { description: "Intl locale", type: "string", default: '"en-US"' },
    children: {
      description: "Compose layout, actions, and announcements",
      type: "ReactNode",
    },
  }}
/>

### Column Options

<TypeTable
  type={{
    key: { description: "Row data key", type: "keyof T", required: true },
    label: { description: "Header text", type: "string", required: true },
    format: { description: "Cell formatting", type: "FormatConfig" },
    priority: {
      description: "Mobile visibility",
      type: "'primary' | 'secondary' | 'tertiary'",
    },
    sortable: {
      description: "Enable sorting",
      type: "boolean",
      default: "true",
    },
    align: {
      description: "Text alignment",
      type: "'left' | 'right' | 'center'",
    },
    truncate: { description: "Truncate with ellipsis", type: "boolean" },
  }}
/>

### Sorting

<TypeTable
  type={{
    defaultSort: {
      description: "Initial sort",
      type: "{ by?: keyof T; direction?: 'asc' | 'desc' }",
    },
    sort: {
      description: "Controlled sort",
      type: "{ by?: keyof T; direction?: 'asc' | 'desc' }",
    },
    onSortChange: { description: "Sort handler", type: "(sort) => void" },
  }}
/>

### Response Actions (DataTable.Actions)

Add a `<DataTable.Actions />` child to render response buttons below the table.

<TypeTable
  type={{
    responseActions: {
      description: "Surface-level actions below the table",
      type: "Action[] | ActionsConfig",
    },
    onResponseAction: {
      description: "Click handler",
      type: "(actionId: string) => void",
    },
    onBeforeResponseAction: {
      description: "Gate actions (return false to cancel)",
      type: "(actionId: string) => boolean | Promise<boolean>",
    },
  }}
/>

## Formatting

All visual formatting for data stays declarative via `columns[i].format`. Keep row values as primitives and describe presentation through format configs.

<TypeTable
  type={{
    number: {
      description: (
        <FormatInlineExample
          value={12345.678}
          output={
            <NumberValue
              value={12345.678}
              options={{ kind: "number", decimals: 2, unit: " ms" }}
            />
          }
        />
      ),
      type: "{ kind: 'number', decimals?: number, unit?: string }",
    },
    currency: {
      description: (
        <FormatInlineExample
          value={178.25}
          output={
            <CurrencyValue
              value={178.25}
              options={{ kind: "currency", currency: "USD", decimals: 2 }}
            />
          }
        />
      ),
      type: "{ kind: 'currency', currency: string, decimals?: number }",
    },
    percent: {
      description: (
        <>
          <FormatInlineExample
            value={0.123}
            output={
              <PercentValue
                value={0.123}
                options={{
                  kind: "percent",
                  basis: "fraction",
                  decimals: 1,
                  showSign: true,
                }}
              />
            }
          />
          <FormatInlineExample
            value={1.23}
            output={
              <PercentValue
                value={1.23}
                options={{
                  kind: "percent",
                  basis: "unit",
                  decimals: 2,
                  showSign: true,
                }}
              />
            }
          />
        </>
      ),
      type: "{ kind: 'percent', basis: 'fraction' | 'unit', decimals?: number, showSign?: boolean }",
    },
    delta: {
      description: (
        <>
          <FormatInlineExample
            value={2.35}
            output={
              <DeltaValue
                value={2.35}
                options={{
                  kind: "delta",
                  decimals: 2,
                  upIsPositive: true,
                  showSign: true,
                }}
              />
            }
          />
          <FormatInlineExample
            value={-1.2}
            output={
              <DeltaValue
                value={-1.2}
                options={{
                  kind: "delta",
                  decimals: 2,
                  upIsPositive: true,
                  showSign: true,
                }}
              />
            }
          />
        </>
      ),
      type: "{ kind: 'delta', decimals?: number, upIsPositive?: boolean, showSign?: boolean }",
    },
    date: {
      description: (
        <>
          <FormatInlineExample
            value={"2025-01-05T12:00:00Z"}
            output={
              <DateValue
                value={"2025-01-05T12:00:00Z"}
                options={{ kind: "date", dateFormat: "relative" }}
              />
            }
          />
          <FormatInlineExample
            value={"2025-01-05T12:00:00Z"}
            output={
              <DateValue
                value={"2025-01-05T12:00:00Z"}
                options={{ kind: "date", dateFormat: "long" }}
                locale="de-DE"
              />
            }
            note="Long date with locale"
          />
        </>
      ),
      type: "{ kind: 'date', dateFormat?: 'short' | 'long' | 'relative' }",
    },
    boolean: {
      description: (
        <FormatInlineExample
          value={true}
          output={
            <BooleanValue
              value={true}
              options={{
                kind: "boolean",
                labels: { true: "Yes", false: "No" },
              }}
            />
          }
        />
      ),
      type: "{ kind: 'boolean', labels?: { true: string; false: string } }",
    },
    link: {
      description: (
        <>
          <FormatInlineExample
            value={"Docs Portal"}
            output={
              <LinkValue
                value={"Docs Portal"}
                row={{ url: "/docs" }}
                options={{ kind: "link", hrefKey: "url" }}
              />
            }
          />
          <FormatInlineExample
            value={"https://example.com"}
            output={
              <LinkValue
                value={"https://example.com"}
                options={{ kind: "link", external: true }}
              />
            }
          />
        </>
      ),
      type: "{ kind: 'link', hrefKey?: string, external?: boolean }",
    },
    badge: {
      description: (
        <FormatInlineExample
          value={"open"}
          output={
            <BadgeValue
              value={"open"}
              options={{
                kind: "badge",
                colorMap: { open: "info", closed: "success" },
              }}
            />
          }
        />
      ),
      type: "{ kind: 'badge', colorMap?: Record<string, Tone> }",
    },
    status: {
      description: (
        <FormatInlineExample
          value={"high"}
          output={
            <StatusBadge
              value={"high"}
              options={{
                kind: "status",
                statusMap: {
                  high: { tone: "danger", label: "High" },
                  low: { tone: "neutral", label: "Low" },
                },
              }}
            />
          }
        />
      ),
      type: "{ kind: 'status', statusMap: Record<string, { tone: Tone; label?: string }> }",
    },
    array: {
      description: (
        <FormatInlineExample
          value={["alpha", "beta", "gamma"]}
          output={
            <ArrayValue
              value={["alpha", "beta", "gamma"]}
              options={{ kind: "array", maxVisible: 2 }}
            />
          }
        />
      ),
      type: "{ kind: 'array', maxVisible?: number }",
    },
  }}
/>

## Accessibility

- Uses semantic `<table>` markup with proper header associations
- Sortable columns are keyboard-accessible via shadcn/ui Button
- Row selection uses standard checkbox patterns from Radix
