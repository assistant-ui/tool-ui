import { CopyMarkdownButton } from "../_components/copy-markdown-button";
import { DataTable } from "@/components/data-table";
import { FormatInlineExample } from "./formatting-gallery";
import {
  NumberValue,
  CurrencyValue,
  PercentValue,
  DeltaValue,
  DateValue,
  BooleanValue,
  LinkValue,
  BadgeValue,
  StatusBadge,
  ArrayValue,
} from "@/components/data-table";

<div className="flex justify-between items-start">
  # Data Table
  <CopyMarkdownButton />
</div>

A compact, responsive data table with tri‑state sorting, declarative value formatting, and row actions.

<Tabs items={["Preview", "Code"]}>
  <Tab>
    <div className="not-prose">
      <DataTable
        rowIdKey="id"
        defaultSort={{ by: "priority", direction: "asc" }}
        columns={[
          { key: "issue", label: "Issue", priority: "primary", truncate: true },
          {
            key: "priority",
            label: "Urgency",
            format: {
              kind: "status",
              statusMap: {
                high: { tone: "danger", label: "High" },
                medium: { tone: "warning", label: "Medium" },
                low: { tone: "neutral", label: "Low" },
              },
            },
          },
        ]}
        data={[
          { id: "1", issue: "Payment failing on checkout", priority: "high" },
          { id: "2", issue: "Billing UI alignment bug", priority: "medium" },
          { id: "3", issue: "Export CSV missing headers", priority: "low" },
          { id: "4", issue: "Webhook retries inconsistent", priority: "high" },
        ]}
      />
    </div>

  </Tab>
  <Tab>
    ```tsx
    import { DataTable, type Column } from "@/components/data-table";

    type Row = { id: string; issue: string; priority: "high" | "medium" | "low" };

    const columns: Column<Row>[] = [
      { key: "issue", label: "Issue", priority: "primary", truncate: true },
      { key: "priority", label: "Urgency", format: { kind: "status", statusMap: {
        high: { tone: "danger", label: "High" }, medium: { tone: "warning", label: "Medium" }, low: { tone: "neutral", label: "Low" }
      } } },
    ];

    const data: Row[] = [
      { id: "1", issue: "Payment failing on checkout", priority: "high" },
      { id: "2", issue: "Billing UI alignment bug", priority: "medium" },
      { id: "3", issue: "Export CSV missing headers", priority: "low" },
      { id: "4", issue: "Webhook retries inconsistent", priority: "high" },
    ];

    export default function Example() {
      return (
        <DataTable rowIdKey="id" columns={columns} data={data} defaultSort={{ by: "priority", direction: "asc" }} />
      );
    }
    ```
  </Tab>
</Tabs>

## When to use

- **Quick rule of thumb**: scan-and-act → Data Table; read-and-understand → rich text; tiny-static → markdown table.
- **Use Data Table when** you compare 3+ rows across shared attributes (≥2 sortable columns), need numeric/date alignment, row actions, or consistent formats, and expect the data to grow (tool/LLM output) while staying mobile-friendly via column `priority`.
- **Prefer rich text when** the goal is narrative reading, irregular fields per item, long paragraphs/snippets, or just a few highlighted insights.
- **Prefer a markdown table when** the dataset is tiny and static (≈2–4 rows, 2–3 columns) with zero sorting, actions, or formatting requirements.
- **Avoid**: long paragraphs or nested objects in cells, too many mobile columns (promote/demote `priority` or swap to cards), and non-primitive row values (push presentation into `columns[i].format`).

## Source & install

- [Source on GitHub](https://github.com/assistant-ui/tool-ui/tree/main/components/data-table)
- [Quick download (ZIP)](https://download-directory.github.io/?url=https://github.com/assistant-ui/tool-ui/tree/main/components/data-table)

## UI primitives

This table wraps [shadcn/ui](https://ui.shadcn.com) primitives via a tiny adapter—swap implementations by editing `components/data-table/_ui.tsx`.

| Primitive | Path |
| --- | --- |
| `Button` | `components/ui/button.tsx` |
| `DropdownMenu` | `components/ui/dropdown-menu.tsx` |
| `Accordion` | `components/ui/accordion.tsx` |
| `Tooltip` | `components/ui/tooltip.tsx` |
| `Badge` | `components/ui/badge.tsx` |
| `Table` | `components/ui/table.tsx` |


## Features
Short, high‑leverage features you’ll use most often, with tiny examples and why they help.

### Sorting
Tri‑state sorting: none → asc → desc (click again to reset). Use controlled mode to sync with filters or the URL.
```tsx
// Uncontrolled (internal tri‑state): click header to cycle none → asc → desc → none
<DataTable columns={columns} data={data} />

// Controlled: manage sort in parent
const [sort, setSort] = useState<{ by?: keyof Row; direction?: 'asc' | 'desc' }>({});
<DataTable columns={columns} data={data} sort={sort} onSortChange={setSort} />
```

### Responsive layout
Container queries switch between table and cards; `priority` decides what stays visible on mobile headers.

> Tailwind v4 ships container queries; on v3 install the [tailwind/container-queries](https://github.com/tailwindlabs/tailwindcss-container-queries) plugin.
```tsx
// Auto (default): container queries switch between table/cards at @md
<DataTable columns={columns} data={data} />

// Force a particular layout
<DataTable layout="table" columns={columns} data={data} />
<DataTable layout="cards" columns={columns} data={data} />

// Mobile: `priority` controls card header vs. accordion details
const columns = [
  { key: 'name', label: 'Name', priority: 'primary' },
  { key: 'price', label: 'Price', priority: 'primary' },
  { key: 'category', label: 'Category', priority: 'secondary' },
  { key: 'sku', label: 'SKU', priority: 'tertiary' },
];
```

### Declarative formatting
Keep row values primitive; describe presentation in `columns[i].format`. It keeps UI consistent and LLM/tool outputs JSON‑serializable.
```tsx
// Keep data primitive; describe presentation in format
{ key: 'price', label: 'Price', format: { kind: 'currency', currency: 'USD' } }
{ key: 'homepage', label: 'Homepage', format: { kind: 'link', external: true } }
{ key: 'status', label: 'Status', format: { kind: 'badge', colorMap: { open: 'info', closed: 'success' } } }
```

### Accessibility
- Header buttons are focusable; `aria-sort` reflects state for screen readers
- A live region announces sort changes; rows and cells read with labels
- Table toggles `aria-busy` when loading so assistive tech knows data is pending

## Data shape

Primitive rows ensure LLM/tool output is JSON-serializable and renderable.

<details className="mt-3">
  <summary className="cursor-pointer text-sm font-medium">Why primitives?</summary>
  <div className="mt-2 text-sm text-muted-foreground">
    They hydrate quickly, avoid Date/timezone mismatches, and keep formatting centralized in
    <code>columns[i].format</code>.
  </div>
</details>

<TypeTable
  type={{
    data: {
      description: "Rows to render. Each row is a record of JSON‑serializable values.",
      type: "T[]",
      required: true,
    },
    "Row Type T": {
      description: "Record of JSON primitives or arrays of primitives.",
      type: "DataTableRowData = Record<string, RowPrimitive>",
      typeDescriptionLink: "components/data-table/data-table.tsx:23",
    },
    RowPrimitive: {
      description:
        "string | number | boolean | null | arrays of these. Do not place objects, Dates, Maps, or functions in row values.",
      type: "string | number | boolean | null | JsonPrimitive[]",
      typeDescriptionLink: "components/data-table/data-table.tsx:18",
    },
  }}
/>

## API at a glance

### Data

<TypeTable
  type={{
    columns: { description: "Column definitions", type: "Column<T>[]", required: true },
    data: { description: "Serializable rows (see Data shape)", type: "T[]", required: true },
    rowIdKey: { description: "Stable unique key in each row", type: "keyof T" },
    locale: { description: "Intl locale for formatting", type: "string", default: '"en-US"' },
  }}
/>

### Layout

<TypeTable
  type={{
    layout: { description: "Force table/cards or auto", type: "'auto' | 'table' | 'cards'", default: "'auto'" },
    maxHeight: { description: "Scroll container height", type: "string (CSS)" },
    emptyMessage: { description: "Shown when no rows", type: "string", default: '"No data available"' },
    isLoading: { description: "Show skeletons", type: "boolean", default: "false" },
  }}
/>

### Sorting

<TypeTable
  type={{
    defaultSort: { description: "Initial sort (uncontrolled)", type: "{ by?: keyof T; direction?: 'asc' | 'desc' }" },
    sort: { description: "Controlled sort state (with onSortChange)", type: "{ by?: keyof T; direction?: 'asc' | 'desc' }" },
    onSortChange: { description: "Update controlled sort", type: "(next) => void" },
  }}
/>

### Actions

<TypeTable
  type={{
    actions: { description: "Row actions", type: "Action[]" },
    onBeforeAction: { description: "Gate actions (confirm, policy)", type: "(args) => boolean | Promise<boolean>" },
    onAction: { description: "Action click handler", type: "(id, row, ctx?) => void" },
  }}
/>

Full types: components/data-table/data-table.tsx

## FormatConfig
All visual formatting for data stays declarative via `columns[i].format`.

<details className="mt-4">
  <summary className="cursor-pointer text-sm font-medium text-primary">Show formatting kinds</summary>
  <div className="mt-4 space-y-4">
    <TypeTable
      type={{
        number: {
          description: (
            <FormatInlineExample
              value={12345.678}
              output={<NumberValue value={12345.678} options={{ kind: 'number', decimals: 2, unit: ' ms' }} />}
            />
          ),
          type: "{ kind: 'number', decimals: 2, unit: ' ms' }",
        },
        currency: {
          description: (
            <FormatInlineExample
              value={178.25}
              output={<CurrencyValue value={178.25} options={{ kind: 'currency', currency: 'USD', decimals: 2 }} />}
            />
          ),
          type: "{ kind: 'currency', currency: 'USD', decimals: 2 }",
        },
        percent: {
          description: (
            <>
              <FormatInlineExample
                value={0.123}
                output={<PercentValue value={0.123} options={{ kind: 'percent', basis: 'fraction', decimals: 1, showSign: true }} />}
                note="0.123 → 12.3%"
              />
              <FormatInlineExample
                value={1.23}
                output={<PercentValue value={1.23} options={{ kind: 'percent', basis: 'unit', decimals: 2, showSign: true }} />}
                note="1.23 → 1.23%"
              />
            </>
          ),
          type: "{ kind: 'percent', basis: 'fraction' | 'unit', decimals?: number, showSign?: boolean }",
        },
        delta: {
          description: (
            <>
              <FormatInlineExample
                value={2.35}
                output={<DeltaValue value={2.35} options={{ kind: 'delta', decimals: 2, upIsPositive: true, showSign: true }} />}
              />
              <FormatInlineExample
                value={-1.2}
                output={<DeltaValue value={-1.2} options={{ kind: 'delta', decimals: 2, upIsPositive: true, showSign: true }} />}
              />
            </>
          ),
          type: "{ kind: 'delta', decimals?: number, upIsPositive?: boolean, showSign?: boolean }",
        },
        date: {
          description: (
            <>
              <FormatInlineExample
                value={'2025-01-05T12:00:00Z'}
                output={<DateValue value={'2025-01-05T12:00:00Z'} options={{ kind: 'date', dateFormat: 'relative' }} />}
              />
              <FormatInlineExample
                value={'2025-01-05T12:00:00Z'}
                output={<DateValue value={'2025-01-05T12:00:00Z'} options={{ kind: 'date', dateFormat: 'long' }} locale="de-DE" />}
                note="Long date with locale"
              />
            </>
          ),
          type: "{ kind: 'date', dateFormat?: 'short' | 'long' | 'relative' }",
        },
        boolean: {
          description: (
            <FormatInlineExample
              value={true}
              output={<BooleanValue value={true} options={{ kind: 'boolean', labels: { true: 'Yes', false: 'No' } }} />}
            />
          ),
          type: "{ kind: 'boolean', labels?: { true: string; false: string } }",
        },
        link: {
          description: (
            <>
              <FormatInlineExample
                value={'Docs Portal'}
                output={<LinkValue value={'Docs Portal'} row={{ url: '/docs' }} options={{ kind: 'link', hrefKey: 'url' }} />}
              />
              <FormatInlineExample
                value={'https://example.com'}
                output={<LinkValue value={'https://example.com'} options={{ kind: 'link', external: true }} />}
              />
            </>
          ),
          type: "{ kind: 'link', hrefKey?: string, external?: boolean }",
        },
        badge: {
          description: (
            <FormatInlineExample
              value={'open'}
              output={<BadgeValue value={'open'} options={{ kind: 'badge', colorMap: { open: 'info', closed: 'success' } }} />}
            />
          ),
          type: "{ kind: 'badge', colorMap?: Record<string, Tone> }",
        },
        status: {
          description: (
            <FormatInlineExample
              value={'high'}
              output={<StatusBadge value={'high'} options={{ kind: 'status', statusMap: { high: { tone: 'danger', label: 'High' }, low: { tone: 'neutral', label: 'Low' } } }} />}
            />
          ),
          type: "{ kind: 'status', statusMap: Record<string, { tone: Tone; label?: string }> }",
        },
        array: {
          description: (
            <FormatInlineExample
              value={['alpha','beta','gamma']}
              output={<ArrayValue value={['alpha','beta','gamma']} options={{ kind: 'array', maxVisible: 2 }} />}
            />
          ),
          type: "{ kind: 'array', maxVisible?: number }",
        },
      }}
    />
  </div>
</details>

## Recipes

<div className="flex flex-wrap items-center justify-between gap-3">
  <p className="text-sm text-muted-foreground">Copy a snippet or jump into the live presets.</p>
  <a
    className="text-sm text-primary underline underline-offset-4"
    href="/docs/data-table?tab=examples#examples"
  >
    Open Examples tab
  </a>
</div>

### Controlled sorting
```tsx
const [sort, setSort] = useState<{ by?: keyof Row; direction?: 'asc' | 'desc' }>({});
<DataTable columns={columns} data={data} sort={sort} onSortChange={setSort} />
```

### Actions with confirmation
```tsx
<DataTable
  actions={[{ id: 'delete', label: 'Delete', variant: 'destructive', requiresConfirmation: true }]}
  onBeforeAction={({ action, row }) => action.requiresConfirmation ? window.confirm(`Delete ${String((row as any).issue)}?`) : true}
  onAction={(id, row) => doAction(id, row)}
/>
```

### Mobile priorities
```tsx
const columns = [
  { key: 'name', label: 'Name', priority: 'primary' },
  { key: 'price', label: 'Price', align: 'right', priority: 'primary' },
  { key: 'category', label: 'Category', priority: 'secondary' },
  { key: 'sku', label: 'SKU', priority: 'tertiary' },
];
```

### Fixed width + truncate
```tsx
{ key: 'issue', label: 'Issue', width: '160px', truncate: true }
```

### Locale + Intl formatting
```tsx
<DataTable locale="de-DE" columns={[{ key: 'price', label: 'Preis', align: 'right', format: { kind: 'currency', currency: 'EUR' } }]} data={[{ price: 19.5 }]} />
```

### Loading, empty states, and max height
```tsx
<DataTable isLoading emptyMessage="No items" maxHeight="400px" columns={columns} data={[]} />
```

## Tips & troubleshooting
- Validate untrusted/LLM output with `parseSerializableDataTable` before rendering
- Reuse the Advanced tool examples if you need typed tool parts or schema guards
- Verify `onAction` is passed and IDs match when row actions do nothing
- Keep controlled sorting in sync via `onSortChange`, or drop `sort` for the built-in tri-state
- Confirm container queries (Tailwind v4 or the plugin) when the mobile card layout never appears
- Adjust `priority` or `hideOnMobile` if columns disappear on compact screens
